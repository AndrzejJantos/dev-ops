# Brokik API Environment Configuration
# Domain: brokik.com
# Type: Rails API with background processing

# ============================================================================
# RAILS ENVIRONMENT
# ============================================================================
RAILS_ENV=production
RACK_ENV=production
NODE_ENV=production

# ============================================================================
# APPLICATION
# ============================================================================
APP_NAME=brokik-api
DOMAIN=brokik.com

# Secret key base - MUST be changed for production
# Generate with: rails secret
SECRET_KEY_BASE=CHANGE_ME_IN_PRODUCTION

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
DATABASE_URL=postgresql://brokik_user:CHANGE_DB_PASSWORD@localhost:5432/brokik_production
DB_POOL=25

# For Docker build compatibility
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=brokik_production
POSTGRES_USER=brokik_user
POSTGRES_PASSWORD=CHANGE_DB_PASSWORD

# ============================================================================
# REDIS CONFIGURATION (for Sidekiq and caching)
# ============================================================================
REDIS_URL=redis://localhost:6379/3
REDIS_CACHE_URL=redis://localhost:6379/4

# ============================================================================
# WEB SERVER CONFIGURATION
# ============================================================================
PORT=80
RAILS_MAX_THREADS=5
WEB_CONCURRENCY=2

# ============================================================================
# FRONTEND CONFIGURATION
# ============================================================================
# Allow CORS from frontend domains (comma-separated)
ALLOWED_ORIGINS=https://brokik.com,https://www.brokik.com
FRONTEND_URL=https://brokik.com

# ============================================================================
# API ROUTING
# ============================================================================
# API uses two route prefixes:
# - /api/public/*   - Public endpoints (no auth required)
# - /api/internal/* - Protected endpoints (JWT auth required)

# ============================================================================
# RAILS CONFIGURATION
# ============================================================================
RAILS_LOG_LEVEL=info
RAILS_SERVE_STATIC_FILES=true
CONTAINER_NAME=brokik-api-web

# Asset host (if using CDN)
# ASSET_HOST=https://cdn.brokik.com

# ============================================================================
# EMAIL CONFIGURATION (Action Mailer)
# ============================================================================
SMTP_ADDRESS=smtp.mailgun.org
SMTP_PORT=587
SMTP_USERNAME=postmaster@mg.brokik.com
SMTP_PASSWORD=CHANGE_MAILGUN_PASSWORD
SMTP_DOMAIN=mg.brokik.com
SMTP_AUTHENTICATION=plain
SMTP_ENABLE_STARTTLS_AUTO=true

# Default email addresses
DEFAULT_FROM_EMAIL=noreply@brokik.com
SUPPORT_EMAIL=support@brokik.com

# ============================================================================
# EXTERNAL API KEYS
# ============================================================================
# Add your external API keys here
# STRIPE_SECRET_KEY=
# STRIPE_PUBLISHABLE_KEY=
# GOOGLE_MAPS_API_KEY=

# ============================================================================
# STORAGE CONFIGURATION (Active Storage)
# ============================================================================
# Service options: local, host_disk, scaleway
# - local: Stores files inside Docker container (lost on container removal)
# - host_disk: Stores files on host machine (persists across deployments)
# - scaleway: Stores files in Scaleway S3 bucket
RAILS_ACTIVE_STORAGE_SERVICE=host_disk

# Host disk storage path (used when RAILS_ACTIVE_STORAGE_SERVICE=host_disk)
# Directory structure: /var/storage/{app-name}/active_storage
# This directory will be mounted as a volume in Docker containers
ACTIVE_STORAGE_HOST_PATH=/var/storage/brokik-api/active_storage

# CDN Configuration (nginx-based CDN for serving files directly)
# When CDN_HOST is set, Active Storage will generate CDN URLs instead of Rails routes
# URL pattern: https://cdn.webet.pl/{app-name}/blobs/{key}
# This bypasses Rails and serves files directly from nginx for better performance
CDN_HOST=https://cdn.webet.pl

# URL for accessing stored files (DEPRECATED when using CDN)
# This is still used for some Rails internals but CDN_HOST takes precedence
FILES_STORAGE_URL=brokik.com

# Scaleway S3 configuration (if using RAILS_ACTIVE_STORAGE_SERVICE=scaleway)
# SCALEWAY_ENDPOINT=https://brokik-prod.s3.fr-par.scw.cloud
# SCALEWAY_ACCESS_KEY_ID=
# SCALEWAY_SECRET_ACCESS_KEY=
# SCALEWAY_REGION=fr-par
# SCALEWAY_BUCKET_NAME=brokik-production

# ============================================================================
# BACKGROUND JOBS (Sidekiq)
# ============================================================================
SIDEKIQ_CONCURRENCY=10

# ============================================================================
# PERFORMANCE & CACHING
# ============================================================================
CACHE_STORE=redis_cache_store

# ============================================================================
# MONITORING & ERROR TRACKING
# ============================================================================
# Sentry for error tracking
# SENTRY_DSN=

# New Relic for performance monitoring
# NEW_RELIC_LICENSE_KEY=
# NEW_RELIC_APP_NAME=Brokik API

# ============================================================================
# FEATURE FLAGS
# ============================================================================
ENABLE_API_RATE_LIMITING=true
ENABLE_REQUEST_LOGGING=true

# ============================================================================
# SECURITY
# ============================================================================
# JWT configuration for API authentication
JWT_SECRET_KEY=CHANGE_ME_IN_PRODUCTION
JWT_EXPIRATION_HOURS=24

# API rate limiting
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_PERIOD=60

# ============================================================================
# LOCALE & TIMEZONE
# ============================================================================
DEFAULT_LOCALE=pl
AVAILABLE_LOCALES=pl,en
TIME_ZONE=Warsaw
